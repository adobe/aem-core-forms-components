<!--/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  ~ Copyright 2021 Adobe
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/-->
<!-- Reference for synthetic resource https://gist.github.com/gabrielwalt/0da85e4855070dc6264652269729eddf -->

<sly data-sly-use.model="com.adobe.cq.forms.core.components.models.formsportal.SearchAndLister"
     data-sly-use.logic="${'searchnlister.js' @ layout=model.layout}"
     data-sly-use.clientlib="${'/libs/granite/sightly/templates/clientlib.html'}"
     data-sly-use.items="itemTemplate.html"></sly>
<script>
    // Dispatch Initialization events for this instance
    (function () {
        var onScriptLoad = function (evnt) {
            var componentApp = evnt.detail.searchAndLister;
            componentApp.initializeComponent({
                "id": "${model.id @ context='scriptString'}",
                "queryPath": "${resource.path @ context='scriptString'}.fpquery.json",
                "layout": "${model.layout @ context='scriptString'}",
                "paths": "${model.folderPaths @ context='scriptString'}",
                "limit": "${model.resultLimit @ context='scriptString'}",
                "": "${model.resultLimit @ context='scriptString'}"
            });
            window.removeEventListener("searchnlister-onload", onScriptLoad);
        };
        window.addEventListener("searchnlister-onload", onScriptLoad);
    }());
</script>
<div class="cmp-searchnlister" id="${model.id}">
    <h1 class="cmp-searchnlister__heading" data-sly-text="${model.title}">Forms Portal</h1>
    <div class="cmp-searchnlister__seperator" data-sly-resource.seperator="${logic.seperator}"></div>
    <div class="cmp-searchnlister-search" data-sly-test="${!model.textSearchDisabled || !model.advancedSearchDisabled}">
        <div class="cmp-searchnlister-search__box" data-sly-test.textSearch="${!model.textSearchDisabled}">
            <input class="cmp-searchnlister-search__box--text" data-cmp-hook-formssearch="input" type="text" placeholder="Search">
        </div>
        <div class="cmp-searchnlister-search__sortbutton--wrapper" data-sly-test.advancedSearch="${!model.advancedSearchDisabled}">
            <select class="cmp-searchnlister-search__sortbutton" data-cmp-hook-formssearch="filter">
                <option value="" disabled selected="selected">Filter By</option>
                <option value="tags">Tag</option>
                <option value="title">Title</option>
                <option value="description">Description</option>
            </select>
        </div>
        <div class="cmp-searchnlister-search__sortbutton--wrapper" data-sly-test.advancedSearch="${!model.advancedSearchDisabled}">
            <select class="cmp-searchnlister-search__sortbutton cmp-searchnlister-search__sortbutton--right" data-cmp-hook-formssearch="sort">
                <option value="" disabled selected="selected">Sort By</option>
                <option value="asc">Ascending</option>
                <option value="desc">Descending</option>
            </select>
        </div>
    </div>
    <div class="cmp-searchnlister-results" data-cmp-hook-formssearch="results"></div>
    <div class="cmp-searchnlister__more" data-cmp-hook-formssearch="more">Load more</div>
    <sly data-sly-call="${items.include @ file='itemTemplate.html', style=model.layout}"></sly>
    <sly data-sly-call="${clientlib.all @ categories=logic.clientlibs}"></sly>
</div>
